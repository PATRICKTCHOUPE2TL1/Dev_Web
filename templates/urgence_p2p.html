<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>urgence</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='csssss/index.css') }}" type="text/css"">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
	 <script type="text/javascript">
	 /*
	if(type=="medecin"){
	 var ecstatic = require('ecstatic')
	 var server = require('http').createServer(
	   ecstatic({ root: __dirname, handleError: false })
	 )
	 var p2pserver = require('socket.io-p2p-server').Server
	 var io = require('socket.io')(server) 

	 server.listen(3031, function () {
	   console.log('Listening on 3030')
	 })

	 io.use(p2pserver)

	 io.on('connection', function (socket) {
	   socket.on('peer-msg', function (data) {
	   console.log('Message from peer: %s', data)
	   socket.broadcast.emit('peer-msg', data)
	   })

	 socket.on('peer-file', function (data) {
		console.log('File from peer: %s', data)
		socket.broadcast.emit('peer-file', data)
	 })

	 socket.on('go-private', function (data) {
		socket.broadcast.emit('go-private', data)
	 })
	})
	}else{
	var P2P = require('socket.io-p2p');
	var io = require('socket.io-client');
	var socket = io();

	var p2p = new P2P(socket);

	p2p.on('ready', function(){
	  p2p.usePeerConnection = true;
	  p2p.emit('peer-obj', { peerId: peerId });
	})

	// this event will be triggered over the socket transport
	// until `usePeerConnection` is set to `true`
	p2p.on('peer-msg', function(data){
	  console.log(data);
	});
	}
	 */
      var socket = io.connect('http://' + document.domain + ':' + location.port);
	  /*var opts = {autoUpgrade: false, numClients: 10};
	  var p2psocket = new P2P(socket, opts)
	  p2psocket.on('peer-msg', function(data) {
	  // append message to list
	  });

	  p2psocket.on('go-private', function () {
	    p2psocket.upgrade(); // upgrade to peerConnection
	  });
	  var server = require('http').createServer();
	  var p2pserver = require('socket.io-p2p-server').Server
	  var io = require('socket.io')(server);
	  server.listen(3030)
	  io.use(p2pserver);*/
	  let num=0
	  if( $(document.getElementById("test").value()) =="medecin"&&num<1){
	  num=num+1
      socket.on( 'connect', function() {
	  
        socket.emit( 'my event', {
          data: 'User Connected'
        } )
        var form = $( 'form' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_input = $( 'input.message' ).val()
          socket.emit( 'my event', {
            message : user_input
          } )
          $( 'input.message' ).val( '' ).focus()
        } )
		
      } )
      socket.on( 'my response', function( msg ) {
        console.log( msg )
        if( typeof msg.message !== 'undefined' ) {
          $( 'h3' ).remove()
          $( 'div.message_holder' ).append( '<b></b> '+msg.message+'<b></b>' )
        }
      })
	  }
    </script>

<!--  <link rel="stylesheet" href="style.css">
  <script src="script.js"></script> -->
</head>
<body>
<div class="div">
<p>décrivez votre problème</p>
</div>
<h3 >No message yet..</h3>
	
    <div class="message_holder"></div>
	
	
<div class="div">
<form action="" method="POST">
      <input type="text" class="message" placeholder="Messages"/>
      <input type="submit"/>
</form>
<p id="test" value={type_u}>{type_u}</p>
</div>
</body>
</html>